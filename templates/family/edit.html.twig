{% extends 'base.html.twig' %}
{% block title %}Modifier mes informations - Yad Alev{% endblock %}

{% block body %}

<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm py-2 fixed-top">
    <div class="container d-flex justify-content-between align-items-center">

        <!-- Logo + titre -->
        <div class="d-flex align-items-center gap-3">
            <img src="{{ asset('images/LOGO.PNG') }}" alt="Logo Yad Alev" class="nav-logo">
            <span class="fw-bold text-primary fs-5">Modifier mes informations</span>
        </div>

        <!-- Ic√¥nes -->
        <div class="d-flex align-items-center gap-4">
            <a href="{{ path('app_family_info') }}" class="nav-icon" title="Retour √† mes informations">
                <i class="fas fa-arrow-left"></i>
            </a>
            <a href="{{ path('app_logout') }}" class="nav-icon" title="Se d√©connecter">
                <i class="fas fa-sign-out-alt"></i>
            </a>
        </div>

    </div>
</nav>



<!-- PAGE -->
<div class="main-container bg-page">

    <div class="content-wrapper container">

        <!-- TITRE -->
        <div class="text-center mb-5">
            <h2 class="text-primary fw-bold fade-in">Modifier mes informations</h2>
            <p class="text-muted fade-in" style="animation-delay:.2s">
                Mettez √† jour vos informations personnelles si n√©cessaire.
            </p>
        </div>


        <!-- FORMULAIRE -->
        <div class="info-card shadow-sm p-4 fade-in">

            {{ form_start(form, { attr: { enctype:'multipart/form-data' } }) }}

            <div class="accordion" id="editAccordion">

                <!-- IDENTIT√â -->
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse"
                                data-bs-target="#collapseOne" aria-expanded="true">
                            1. Identit√©
                        </button>
                    </h2>

                    <div id="collapseOne" class="accordion-collapse collapse show">
                        <div class="accordion-body">

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-bold">Nom</label>
                                    <input class="form-control bg-light" value="{{ aidRequest.lastName }}" disabled>
                                </div>

                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-bold">Pr√©nom</label>
                                    <input class="form-control bg-light" value="{{ aidRequest.firstName }}" disabled>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-bold">Email</label>
                                    <input class="form-control bg-light" value="{{ aidRequest.email }}" disabled>
                                </div>

                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-bold">T√©l√©phone</label>
                                    <input class="form-control bg-light" value="{{ aidRequest.phoneNumber }}" disabled>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label fw-bold">Date de naissance</label>
                                <input class="form-control bg-light" value="{{ aidRequest.dateOfBirth|date('d/m/Y') }}" disabled>
                            </div>

                        </div>
                    </div>
                </div>


                <!-- FAMILLE & LOGEMENT -->
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                data-bs-target="#collapseTwo">
                            2. Famille & logement
                        </button>
                    </h2>

                    <div id="collapseTwo" class="accordion-collapse collapse">
                        <div class="accordion-body">

                            {{ form_row(form.maritalStatus) }}
                            {{ form_row(form.dependantsCount) }}
                            {{ form_row(form.housingStatus) }}

                            <h5 class="mt-3 fw-bold">Adresse</h5>

                            <div class="row">
                                <div class="col-md-6">
                                    {{ form_row(form.adress.streetNumber) }}
                                </div>
                                <div class="col-md-6">
                                    {{ form_row(form.adress.street) }}
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-4">
                                    {{ form_row(form.adress.postalCode) }}
                                </div>
                                <div class="col-md-8">
                                    {{ form_row(form.adress.city) }}
                                </div>
                            </div>

                        </div>
                    </div>
                </div>


                <!-- FINANCES -->
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                data-bs-target="#collapseThree">
                            3. Finances
                        </button>
                    </h2>

                    <div id="collapseThree" class="accordion-collapse collapse">
                        <div class="accordion-body">

                            <div class="row">
                                <div class="col-md-6">
                                    {{ form_row(form.employmentStatus) }}
                                </div>
                                <div class="col-md-6">
                                    {{ form_row(form.monthlyIncome) }}
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    {{ form_row(form.spouseEmploymentStatus) }}
                                </div>
                                <div class="col-md-6">
                                    {{ form_row(form.spouseMonthlyIncome) }}
                                </div>
                            </div>

                            {{ form_row(form.familyAllowanceAmount) }}
                            {{ form_row(form.alimonyAmount) }}
                            {{ form_row(form.rentAmountNetAide) }}

                        </div>
                    </div>
                </div>


                <!-- DEMANDE D‚ÄôAIDE -->
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                data-bs-target="#collapseFour">
                            4. Demande d‚Äôaide
                        </button>
                    </h2>

                    <div id="collapseFour" class="accordion-collapse collapse">
                        <div class="accordion-body">

                            {{ form_row(form.requestType) }}
                            {{ form_row(form.requestDuration) }}
                            {{ form_row(form.otherRequestDuration) }}
                            {{ form_row(form.requestReason) }}
                            {{ form_row(form.otherNeed) }}
                            {{ form_row(form.urgencyLevel) }}
                            {{ form_row(form.urgencyExplanation) }}

                        </div>
                    </div>
                </div>


                <!-- DOCUMENTS -->
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                data-bs-target="#collapseDocs">
                            5. Documents fournis
                        </button>
                    </h2>

                    <div id="collapseDocs" class="accordion-collapse collapse">
                        <div class="accordion-body">

                            {% macro fileField(label, filename, field) %}
                                <div class="mb-3">
                                    <label class="form-label fw-bold">{{ label }}</label><br>

                                    {% if filename %}
                                        <a href="{{ asset('uploads/' ~ filename) }}" target="_blank" class="text-primary">
                                            Voir le document actuel
                                        </a><br><br>
                                    {% endif %}

                                    {{ form_row(field) }}
                                </div>
                            {% endmacro %}

                            {{ _self.fileField('Justificatif d‚Äôidentit√©', aidRequest.identityProofFilename, form.identityProofFilename) }}
                            {{ _self.fileField('Justificatif de revenus', aidRequest.incomeProofFilename, form.incomeProofFilename) }}
                            {{ _self.fileField('Avis d‚Äôimposition', aidRequest.taxNoticeFilename, form.taxNoticeFilename) }}
                            {{ _self.fileField('Quittance de loyer', aidRequest.quittanceLoyer, form.quittanceLoyer) }}
                            {{ _self.fileField('Avis de charges', aidRequest.avisCharge, form.avisCharge) }}
                            {{ _self.fileField('Taxe fonci√®re', aidRequest.taxeFonciere, form.taxeFonciere) }}
                            {{ _self.fileField('Frais de scolarit√©', aidRequest.fraisScolarite, form.fraisScolarite) }}
                            {{ _self.fileField('Attestation CAF', aidRequest.attestationCaf, form.attestationCaf) }}
                            {{ _self.fileField('Autre document', aidRequest.otherDocumentFilename, form.otherDocumentFilename) }}

                        </div>
                    </div>
                </div>

            </div>


            <!-- CONDITIONS -->
            <div class="mt-4">
                {{ form_row(form.privacyConsent) }}
            </div>


            <!-- BOUTON -->
            <div class="text-center mt-3">
                <button class="btn btn-primary btn-lg shadow-sm edit-btn">
                    üíæ Enregistrer les modifications
                </button>
            </div>

            {{ form_end(form, { render_rest: false }) }}

        </div>
    </div>


    <!-- FOOTER -->
    <footer class="footer-custom text-center text-muted small py-4">
        <div class="footer-line mx-auto"></div>
        <div class="footer-content mt-3">
            <img src="{{ asset('images/LOGO.PNG') }}" alt="Yad Alev" class="footer-logo mb-1">
            <p class="m-0">¬© 2025 Espace Famille Yad Alev ‚Äî Tous droits r√©serv√©s.</p>
        </div>
    </footer>

</div>

<!-- üîî TOAST DE SUCC√àS -->
<div class="toast-container position-fixed top-0 end-0 p-3">
    <div id="saveSuccessToast"
         class="toast align-items-center text-bg-success border-0"
         role="alert"
         aria-live="assertive"
         aria-atomic="true"
         data-bs-delay="2500"
         data-show-toast="{{ showToast|default(false) ? '1' : '0' }}">
        <div class="d-flex">
            <div class="toast-body">
                ‚úÖ Vos informations ont bien √©t√© mises √† jour.
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto"
                    data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const toastEl = document.getElementById('saveSuccessToast');
    if (!toastEl) return;

    const shouldShow = toastEl.dataset.showToast === '1';

    if (shouldShow && typeof bootstrap !== 'undefined') {
        const t = new bootstrap.Toast(toastEl);
        t.show();

        // ‚è≤ redirection apr√®s ~3 secondes vers "Mes informations"
        setTimeout(function () {
            window.location.href = "{{ path('app_family_info') }}";
        }, 3000);
    }
});
</script>


<style>

/* NAVBAR */
.navbar { border-bottom: 1px solid #e2e8f0; }
.nav-logo { width: 48px; }
.nav-icon { font-size: 1.3rem; color:#444; transition:.2s; }
.nav-icon:hover { color:#0d6efd; transform: translateY(-2px); }

/* BACKGROUND */
.bg-page {
    background: linear-gradient(135deg, #f8f9fc, #eef2f7);
}

/* LAYOUT */
.main-container {
    min-height: 100vh;
    padding-top: 110px;
    display: flex;
    flex-direction: column;
}
.info-card {
    background: #fff;
    border-radius: 1rem;
    border: 1px solid #e2e8f0;
}

/* ACCORDION */
.accordion-button {
    font-weight: 600;
    color: #0d6efd;
}
.accordion-button:not(.collapsed) {
    background: #e8f0ff;
    color: #0d6efd;
}
.accordion-item { border: none; }

/* BUTTON */
.edit-btn {
    padding: 10px 25px;
    border-radius: 10px;
}

/* ANIMATIONS */
.fade-in { opacity:0; animation: fadeSlide .7s ease forwards; }
@keyframes fadeSlide {
    from { opacity:0; transform: translateY(25px); }
    to   { opacity:1; transform:translateY(0); }
}

/* FOOTER */
.footer-line { width: 85%; height: 1px; background:#d0d7e0; }
.footer-logo { width: 60px; }

</style>

{% endblock %}
