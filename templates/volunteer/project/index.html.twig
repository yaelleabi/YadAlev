{% extends 'base.html.twig' %}

{% block title %}Missions Bénévoles - Yad Alev
{% endblock %}

{% block body %}

	<nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm py-2 fixed-top">
		<div class="container d-flex justify-content-between align-items-center">
			<div class="d-flex align-items-center gap-3">
				<a href="{{ path('app_volunteer') }}">
					<img src="{{ asset('images/LOGO.PNG') }}" alt="Logo Yad Alev" class="nav-logo">
				</a>
				<span class="fw-bold text-primary fs-5">Missions & Évènements</span>
			</div>

			<!-- Icônes à droite -->
			<div class="d-flex align-items-center gap-4">
				<a href="{{ path('app_volunteer_project_index') }}" class="nav-icon" title="Missions et Évènements">
					<i class="fas fa-hand-holding-heart"></i>
				</a>
				<a href="{{ path('app_volunteer') }}" class="nav-icon" title="Retour Accueil">
					<i class="fas fa-home"></i>
				</a>
				<a href="{{ path('app_logout') }}" class="nav-icon" title="Se déconnecter">
					<i class="fas fa-sign-out-alt"></i>
				</a>
			</div>
		</div>
	</nav>

	<div class="main-container">
		<div class="content-wrapper container flex-grow-1" style="padding-top: 100px;">

			<div class="text-center mb-5 fade-in">
				<h2 class="text-primary fw-bold">Missions Bénévoles</h2>
				<p class="text-muted" style="animation-delay:.2s">
					Découvrez les missions disponibles et participez.
				</p>
			</div>

			{% if events is empty %}
				<div class="text-center py-5 fade-in">
					<div class="text-muted mb-3">
						<i class="fas fa-hand-holding-heart fa-3x"></i>
					</div>
					<h4 class="fw-bold text-muted">Aucune mission disponible pour le moment.</h4>
					<p class="text-muted small">Revenez plus tard pour voir les nouvelles opportunités.</p>
					<a href="{{ path('app_volunteer') }}" class="btn btn-outline-primary mt-3">Retour à l'accueil</a>
				</div>
			{% else %}

				<div class="row g-4 fade-in">
					{% for event in events %}
						<div class="col-md-6 col-lg-4">
							<div class="card h-100 shadow-sm border-0 event-card">
								<div class="card-body d-flex flex-column p-4">
									<div class="d-flex justify-content-between align-items-start mb-3">
										<h5 class="fw-bold text-dark m-0">{{ event.Title }}</h5>
										{% if app.user in event.assignedVolunteers %}
											<span class="badge bg-success shadow-sm rounded-pill">
												<i class="fas fa-check me-1"></i>
												Inscrit</span>
										{% else %}
											<span class="badge bg-primary shadow-sm rounded-pill">Disponible</span>
										{% endif %}
									</div>

									<p class="text-muted small mb-4 flex-grow-1" style="line-height: 1.6;">
										{{ event.Description|nl2br }}
									</p>

									<div class="mb-4 small text-secondary">
										<div class="d-flex align-items-center gap-2 mb-2">
											<i class="far fa-calendar-alt text-primary"></i>
											<span>Du
												<strong>{{ event.startDate|date('d/m/Y') }}</strong>
												au
												<strong>{{ event.endDate|date('d/m/Y') }}</strong>
											</span>
										</div>
									</div>

									<div class="mt-auto pt-3 border-top">
										{% set myReq = myRequests[event.id] ?? null %}

										{% if myReq %}
											<div class="text-center">
												<div class="small text-muted mb-2">Votre demande a été prise en compte</div>
												{% if myReq.status == 'PENDING' %}
													<span class="badge bg-warning text-dark w-100 py-2">
														<i class="fas fa-clock me-1"></i>
														En attente
													</span>
												{% elseif myReq.status == 'ACCEPTED' %}
													<span class="badge bg-success w-100 py-2">
														<i class="fas fa-check-circle me-1"></i>
														Validée
													</span>
												{% elseif myReq.status == 'REFUSED' %}
													<span class="badge bg-danger w-100 py-2">
														<i class="fas fa-times-circle me-1"></i>
														Refusée
													</span>
												{% endif %}
											</div>
										{% elseif app.user in event.assignedVolunteers %}
											{# Cas legacy ou inscription directe hors demande #}
											<button class="btn btn-light text-success w-100 fw-bold disabled" style="opacity: 1;">
												<i class="fas fa-check-circle me-2"></i>
												Vous êtes inscrit
											</button>
										{% else %}
											<form method="post" action="{{ path('app_volunteer_project_register', {'id': event.id}) }}">
												<button class="btn btn-warning w-100 shadow-sm text-dark fw-bold btn-hover-scale">
													Je participe
												</button>
											</form>
										{% endif %}
									</div>
								</div>
							</div>
						</div>
					{% endfor %}
				</div>

			{% endif %}

		</div>

		<footer class="footer-custom text-center text-muted small py-4 mt-5 position-relative" style="z-index: 20;">
			<div class="footer-line mx-auto"></div>
			<p class="m-0">© 2025 Yad Alev — Tous droits réservés.</p>
		</footer>
	</div>

	<style>
		.navbar {
			border-bottom: 1px solid #e2e8f0;
		}
		.nav-logo {
			width: 48px;
		}
		.nav-icon {
			font-size: 1.4rem;
			color: #444;
			transition: 0.2s;
		}
		.nav-icon:hover {
			color: #0d6efd;
			transform: translateY(-2px);
		}

		.main-container {
			min-height: 100vh;
			display: flex;
			flex-direction: column;
		}
		.event-card {
			transition: transform 0.3s ease, box-shadow 0.3s ease;
			border-radius: 1rem;
		}
		.event-card:hover {
			transform: translateY(-5px);
			box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1) !important;
		}

		.btn-hover-scale {
			transition: transform 0.2s;
		}
		.btn-hover-scale:hover {
			transform: scale(1.02);
		}

		.fade-in {
			opacity: 0;
			animation: fadeSlide 0.7s ease forwards;
		}
		@keyframes fadeSlide {
			from {
				opacity: 0;
				transform: translateY(25px);
			}
			to {
				opacity: 1;
				transform: none;
			}
		}

		.footer-line {
			width: 85%;
			height: 1px;
			background: #d0d7e0;
		}
	</style>

{% endblock %}
