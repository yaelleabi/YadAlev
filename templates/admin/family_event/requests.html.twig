{% extends 'base.html.twig' %}

{% block title %}Demandes en attente -
	{{ family_event.Title }}
{% endblock %}

{% block body %}

	<nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm py-2 fixed-top">
		<div class="container d-flex justify-content-between align-items-center">
			<div class="d-flex align-items-center gap-3">
				<a href="{{ path('app_admin') }}">
					<img src="{{ asset('images/LOGO.PNG') }}" alt="Logo Yad Alev" class="nav-logo">
				</a>
				<span class="fw-bold text-primary fs-5">Gestion des demandes</span>
			</div>

			<div class="d-flex align-items-center gap-4">
				<a href="{{ path('admin_family_event_index') }}" class="nav-icon" title="Retour liste">
					<i class="fas fa-arrow-left"></i>
				</a>
				<a href="{{ path('app_logout') }}" class="nav-icon" title="Se déconnecter">
					<i class="fas fa-sign-out-alt"></i>
				</a>
			</div>
		</div>
	</nav>

	<div class="main-container">
		<div class="content-wrapper container" style="padding-top: 100px;">

			<div class="text-center mb-5 fade-in">
				<h2 class="text-primary fw-bold">{{ family_event.Title }}</h2>
				<p class="text-muted">
					Gérez les demandes d'inscription pour ce projet.
				</p>
			</div>

			<div class="info-card shadow-sm fade-in p-4 mx-auto" style="max-width: 800px;">
				<h5 class="fw-bold text-dark mb-4">
					<i class="fas fa-clock text-warning me-2"></i>
					Demandes en attente
				</h5>

				<div class="list-group shadow-sm">
					{% set pendingRequests = [] %}
					{% for req in family_event.familyEventRequests %}
						{% if req.status == 'PENDING' %}
							{% set pendingRequests = pendingRequests|merge([req]) %}
						{% endif %}
					{% endfor %}

					{% if pendingRequests is empty %}
						<div class="list-group-item text-muted text-center py-5">
							<i class="fas fa-check-circle fa-2x mb-3 text-success"></i><br>
							Aucune demande en attente.
						</div>
					{% else %}
						{% for req in pendingRequests %}
							<div class="list-group-item d-flex justify-content-between align-items-center p-3">
								<div>
									<span class="fw-bold fs-5">{{ req.family.name }}
										{{ req.family.firstName }}</span>
									<div class="small text-muted mt-1">
										<i class="far fa-calendar-alt me-1"></i>
										Demandé le
										{{ req.createdAt|date('d/m/Y à H:i') }}
									</div>
								</div>
								<div class="d-flex gap-2">
									<form method="post" action="{{ path('admin_family_event_accept_request', {'id': req.id}) }}">
										<input type="hidden" name="redirect" value="requests">
										<button class="btn btn-success" title="Accepter">
											<i class="fas fa-check me-2"></i>
											Accepter
										</button>
									</form>
									<form method="post" action="{{ path('admin_family_event_refuse_request', {'id': req.id}) }}">
										<input type="hidden" name="redirect" value="requests">
										<button class="btn btn-outline-danger" title="Refuser">
											<i class="fas fa-times me-2"></i>
											Refuser
										</button>
									</form>
								</div>
							</div>
						{% endfor %}
					{% endif %}
				</div>

				<div class="mt-4 text-center">
					<a href="{{ path('admin_family_event_index') }}" class="btn btn-outline-secondary">Retour à la liste</a>
				</div>
			</div>

		</div>

		<footer class="footer-custom text-center text-muted small py-4 mt-5">
			<div class="footer-line mx-auto"></div>
			<p class="m-0">© 2025 Yad Alev — Tous droits réservés.</p>
		</footer>
	</div>

	<style>
		.navbar {
			border-bottom: 1px solid #e2e8f0;
		}
		.nav-logo {
			width: 48px;
		}
		.nav-icon {
			font-size: 1.4rem;
			color: #444;
			transition: 0.2s;
		}
		.nav-icon:hover {
			color: #0d6efd;
			transform: translateY(-2px);
		}
		.main-container {
			min-height: 100vh;
			display: flex;
			flex-direction: column;
		}
		.info-card {
			background: #fff;
			border-radius: 1rem;
			border: 1px solid #e2e8f0;
		}
		.footer-line {
			width: 85%;
			height: 1px;
			background: #d0d7e0;
		}
		.fade-in {
			opacity: 0;
			animation: fadeSlide 0.7s ease forwards;
		}
		@keyframes fadeSlide {
			from {
				opacity: 0;
				transform: translateY(25px);
			}
			to {
				opacity: 1;
				transform: none;
			}
		}
	</style>

{% endblock %}
