{% extends 'base.html.twig' %}

{% block title %}Demandes d‚Äôaide - Admin{% endblock %}

{% block body %}

<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm py-2 fixed-top">
    <div class="container d-flex justify-content-between align-items-center">

        <!-- Logo + titre -->
        <div class="d-flex align-items-center gap-3">
            <img src="{{ asset('images/LOGO.PNG') }}" alt="Logo Yad Alev" class="nav-logo">
            <span class="fw-bold text-primary fs-5">Demandes d‚Äôaide</span>
        </div>

        <!-- Ic√¥nes -->
        <div class="d-flex align-items-center gap-4">
            <a href="{{ path('app_admin') }}" class="nav-icon" title="Retour espace admin">
                <i class="fas fa-home"></i>
            </a>
            <a href="{{ path('app_logout') }}" class="nav-icon" title="Se d√©connecter">
                <i class="fas fa-sign-out-alt"></i>
            </a>
        </div>

    </div>
</nav>


<!-- PAGE -->
<div class="main-container ">

    <div class="content-wrapper container">

        <!-- TITRE -->
        <div class="text-center mb-5">
            <h2 class="text-primary fw-bold fade-in">üìÑ Liste des demandes d‚Äôaide</h2>
            <p class="text-muted fade-in" style="animation-delay:.2s">
                Retrouvez ici toutes les demandes soumises par les familles.
            </p>
        </div>
        <div class="mb-4 p-3 bg-white shadow-sm rounded">
    <form method="get" class="row g-3">

        <div class="col-md-4">
            <label class="form-label fw-bold">Ann√©e</label>
            <select name="year" class="form-select">
                <option value="">Toutes</option>
                {% for year in years %}
                    <option value="{{ year }}" 
                        {% if app.request.get('year') == year %} selected {% endif %}
                    >{{ year }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="col-md-4">
            <label class="form-label fw-bold">Statut</label>
            <select name="status" class="form-select">
                <option value="">Tous</option>
                <option value="En attente"  {{ app.request.get('status') == 'En attente' ? 'selected' : '' }}>En attente</option>
                <option value="Accept√©e"    {{ app.request.get('status') == 'Accept√©e' ? 'selected' : '' }}>Accept√©e</option>
                <option value="Refus√©e"     {{ app.request.get('status') == 'Refus√©e' ? 'selected' : '' }}>Refus√©e</option>
            </select>
        </div>

        <div class="col-md-4 d-flex align-items-end">
            <button class="btn btn-primary w-100">Filtrer</button>
        </div>
    </form>
</div>


        <!-- TABLE WRAPPER -->
        <div class="info-card shadow-sm fade-in">

            <div class="table-responsive">
                <table class="table table-hover align-middle">
                    <thead class="table-light">
                        <tr>
                            <th>Date</th>
                            <th>Pr√©nom</th>
                            <th>Email</th>
                            <th>T√©l√©phone</th>
                            <th>Statut</th>
                            <th class="text-center">Actions</th>
                        </tr>
                    </thead>

                    <tbody>
                    {% for aid_request in aid_requests %}
                        <tr>
                            <td>{{ aid_request.createdAt|date('d/m/Y') }}</td>
                            <td>{{ aid_request.firstName }}</td>
                            <td>{{ aid_request.email }}</td>
                            <td>{{ aid_request.phoneNumber }}</td>

                            <td>
                                <span class="badge
                                    {% if aid_request.status.value == 'En attente' %} bg-warning text-dark
                                    {% elseif aid_request.status.value == 'Accept√©e' %} bg-success
                                    {% elseif aid_request.status.value == 'Refus√©e' %} bg-danger
                                    {% endif %}
                                ">
                                    {{ aid_request.status.value }}
                                </span>
                                 {% if aid_request.isUpdated and aid_request.status == constant('App\\Enum\\AidRequestStatus::PENDING') %}
                                    <span class="badge bg-info text-dark ms-1">
                                        Modifi√©e
                                    </span>
                                 {% endif %}
                            </td>

                            <td class="text-center">
                                <a href="{{ path('app_admin_aidrequest_show', {'id': aid_request.id}) }}"
                                   class="btn btn-sm btn-outline-primary me-1" title="Voir">
                                    <i class="fas fa-eye"></i>
                                </a>

                                <a href="{{ path('app_admin_aidrequest_edit', {'id': aid_request.id}) }}"
                                   class="btn btn-sm btn-outline-success" title="Modifier">
                                    <i class="fas fa-edit"></i>
                                </a>
                            </td>
                        </tr>
                    {% else %}
                        <tr>
                            <td colspan="6" class="text-center py-4 text-muted">
                                <i class="fas fa-inbox"></i> Aucune demande trouv√©e.
                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>

                </table>
            </div>
        </div>

        <!-- BOUTON RETOUR -->
        <div class="text-center mt-4 fade-in" style="animation-delay:.3s">
            <a href="{{ path('app_admin') }}" class="btn btn-outline-primary btn-lg shadow-sm edit-btn">
                ‚¨ÖÔ∏è Retour √† l‚Äôespace administrateur
            </a>
        </div>

        <!-- FOOTER -->
        <footer class="footer-custom text-center text-muted small py-4 mt-5">
            <div class="footer-line mx-auto"></div>
            <p class="m-0">¬© 2025 Yad Alev ‚Äî Tous droits r√©serv√©s.</p>
        </footer>

    </div>
</div>


<style>

/* NAVBAR */
.navbar { border-bottom: 1px solid #e2e8f0; }
.nav-logo { width: 48px; }
.nav-icon { font-size: 1.4rem; color:#444; transition:.2s; }
.nav-icon:hover { color:#0d6efd; transform: translateY(-2px); }

/* LAYOUT */
.main-container {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
}

.info-card {
    background: #fff;
    border-radius: 1rem;
    padding: 20px;
    border: 1px solid #e2e8f0;
}

/* TABLE */
.table-hover tbody tr:hover {
    background: #eaf1ff;
    transition: .2s;
}

/* ANIMATIONS */
.fade-in { opacity:0; animation: fadeSlide .7s ease forwards; }
@keyframes fadeSlide {
    from { opacity:0; transform: translateY(25px); }
    to   { opacity:1; transform:translateY(0); }
}

/* FOOTER */
.footer-line { width: 85%; height: 1px; background:#d0d7e0; }

</style>

{% endblock %}
