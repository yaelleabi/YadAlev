{% extends 'base.html.twig' %}

{% block title %}Détail demande - Admin{% endblock %}

{% block body %}

<nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm py-2 fixed-top">
    <div class="container d-flex justify-content-between align-items-center">
        <div class="d-flex align-items-center gap-3">
            <img src="{{ asset('images/LOGO.PNG') }}" alt="Logo Yad Alev" class="nav-logo">
            <span class="fw-bold text-primary fs-5">Détail d’une demande</span>
        </div>

        <div class="d-flex align-items-center gap-4">
            <a href="{{ path('app_admin_aidrequest_list') }}" class="nav-icon" title="Retour">
                <i class="fas fa-arrow-left"></i>
            </a>
            <a href="{{ path('app_logout') }}" class="nav-icon">
                <i class="fas fa-sign-out-alt"></i>
            </a>
        </div>
    </div>
</nav>

<div class="main-container ">
    <div class="content-wrapper container">

        <div class="text-center mb-5">
            <h2 class="text-primary fw-bold fade-in">Informations de la demande</h2>
        </div>

        <div class="info-card shadow-sm fade-in">

            <div class="accordion" id="infoAccordion">

                {# IDENTITÉ #}
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button" data-bs-toggle="collapse" data-bs-target="#identite">
                            1. Identité
                        </button>
                    </h2>
                    <div id="identite" class="accordion-collapse collapse show">
                        <div class="accordion-body">
                            <p><strong>Nom :</strong> {{ aid_request.lastName }}</p>
                            <p><strong>Prénom :</strong> {{ aid_request.firstName }}</p>
                            <p><strong>Email :</strong> {{ aid_request.email }}</p>
                            <p><strong>Téléphone :</strong> {{ aid_request.phoneNumber }}</p>
                            <p><strong>Date de naissance :</strong> {{ aid_request.dateOfBirth|date('d/m/Y') }}</p>
                        </div>
                    </div>
                </div>

                {# FAMILLE #}
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed" data-bs-toggle="collapse" data-bs-target="#famille">
                            2. Famille & logement
                        </button>
                    </h2>
                    <div id="famille" class="accordion-collapse collapse">
                        <div class="accordion-body">
                            <p><strong>Situation familiale :</strong> {{ aid_request.maritalStatus }}</p>
                            <p><strong>Enfants à charge :</strong> {{ aid_request.dependantsCount }}</p>
                            <p><strong>Logement :</strong> {{ aid_request.housingStatus }}</p>

                            <h5 class="mt-3">Adresse</h5>
                            <p>{{ aid_request.adress.streetNumber }} {{ aid_request.adress.street }}</p>
                            <p>{{ aid_request.adress.postalCode }} {{ aid_request.adress.city }}</p>
                        </div>
                    </div>
                </div>

                {# FINANCES #}
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed" data-bs-toggle="collapse" data-bs-target="#finances">
                            3. Finances
                        </button>
                    </h2>
                    <div id="finances" class="accordion-collapse collapse">
                        <div class="accordion-body">
                            <p><strong>Situation professionnelle :</strong> {{ aid_request.employmentStatus }}</p>
                            <p><strong>Revenu mensuel :</strong> {{ aid_request.monthlyIncome }} €</p>
                            <p><strong>Situation conjoint :</strong> {{ aid_request.spouseEmploymentStatus }}</p>
                            <p><strong>Revenu conjoint :</strong> {{ aid_request.spouseMonthlyIncome }} €</p>
                            <p><strong>Allocations familiales :</strong> {{ aid_request.familyAllowanceAmount }} €</p>
                            <p><strong>Pension alimentaire :</strong> {{ aid_request.alimonyAmount }} €</p>
                            <p><strong>Loyer net :</strong> {{ aid_request.rentAmountNetAide }} €</p>
                        </div>
                    </div>
                </div>

                {# DEMANDE #}
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed" data-bs-toggle="collapse" data-bs-target="#demande">
                            4. Demande d’aide
                        </button>
                    </h2>
                    <div id="demande" class="accordion-collapse collapse">
                        <div class="accordion-body">
                            <p><strong>Type :</strong> {{ aid_request.requestType }}</p>
                            <p><strong>Durée :</strong> {{ aid_request.requestDuration }}</p>
                            <p><strong>Motif :</strong> {{ aid_request.requestReason }}</p>
                            <p><strong>Urgence :</strong> {{ aid_request.urgencyLevel }}/10</p>
                            <p><strong>Justification :</strong> {{ aid_request.urgencyExplanation }}</p>
                        </div>
                    </div>
                </div>

                {# DOCUMENTS #}
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed" data-bs-toggle="collapse" data-bs-target="#docs">
                            5. Documents fournis
                        </button>
                    </h2>
                    <div id="docs" class="accordion-collapse collapse">
                        <div class="accordion-body">

                            {% set docs = {
                                "Identité": aid_request.identityProofFilename,
                                "Revenus": aid_request.incomeProofFilename,
                                "Avis d’imposition": aid_request.taxNoticeFilename,
                                "Quittance de loyer": aid_request.quittanceLoyer,
                                "Avis de charges": aid_request.avisCharge,
                                "Taxe foncière": aid_request.taxeFonciere,
                                "Frais de scolarité": aid_request.fraisScolarite,
                                "Attestation CAF": aid_request.attestationCaf,
                                "Autre document": aid_request.otherDocumentFilename
                            } %}

                            {% for label, file in docs %}
                                {% if file %}
                                    <p>
                                        <strong>{{ label }} :</strong>
                                        <a href="{{ asset('uploads/' ~ file) }}" target="_blank" class="text-primary">
                                            Voir
                                        </a>
                                    </p>
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                </div>

            </div>
        </div>

        {# ACTIONS ADMIN #}
        <div class="text-center mt-5">

            {% if aid_request.status.value == 'En attente' %}
                <form method="post" action="{{ path('app_admin_aidrequest_approve', {id: aid_request.id}) }}" class="d-inline">
                    <button class="btn btn-success btn-lg px-4">✔ Accepter</button>
                </form>

                <form method="post" action="{{ path('app_admin_aidrequest_reject', {id: aid_request.id}) }}" class="d-inline ms-3">
                    <button class="btn btn-danger btn-lg px-4">✖ Rejeter</button>
                </form>
            {% else %}
                <div class="alert alert-info w-50 mx-auto">
                    Statut actuel : <strong>{{ aid_request.status.value|upper }}</strong>
                </div>
            {% endif %}

            <div class="mt-3">
                <a href="{{ path('app_admin_aidrequest_list') }}" class="btn btn-outline-primary btn-lg">
                    ⬅ Retour à la liste
                </a>
            </div>
        </div>

        <footer class="footer-custom text-center text-muted small py-4 mt-5">
            <div class="footer-line mx-auto"></div>
            <p class="m-0">© 2025 Yad Alev — Tous droits réservés.</p>
        </footer>

    </div>
</div>


<style>
.nav-logo { width: 48px; }
.nav-icon { font-size: 1.4rem; color:#444; transition:.2s; }
.nav-icon:hover { color:#0d6efd; }



.info-card {
    background: #fff; border-radius: 1rem;
    padding: 20px; border: 1px solid #e2e8f0;
}

.accordion-button { font-weight: 600; color: #0d6efd; }
.accordion-button:not(.collapsed) { background:#e8f0ff; }

.footer-line { width: 85%; height: 1px; background:#d0d7e0; }
</style>

{% endblock %}
