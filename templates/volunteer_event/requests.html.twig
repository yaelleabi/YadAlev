{% extends 'base.html.twig' %}

{% block title %}Demandes en attente -
	{{ volunteer_event.Title }}
{% endblock %}

{% block body %}
	<nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm py-2 fixed-top">
		<div class="container d-flex justify-content-between align-items-center">
			<div class="d-flex align-items-center gap-3">
				<a href="{{ path('app_admin') }}">
					<img src="{{ asset('images/LOGO.PNG') }}" alt="Logo Yad Alev" class="nav-logo">
				</a>
				<span class="fw-bold text-primary fs-5">Gestion des demandes</span>
			</div>

			<div class="d-flex align-items-center gap-4">
				<a href="{{ path('app_volunteer_event_index') }}" class="nav-icon" title="Retour liste">
					<i class="fas fa-arrow-left"></i>
				</a>
				<a href="{{ path('app_logout') }}" class="nav-icon" title="Se déconnecter">
					<i class="fas fa-sign-out-alt"></i>
				</a>
			</div>
		</div>
	</nav>

	<div class="main-container">

		<div class="content-wrapper container" style="padding-top: 100px;">

			<div class="text-center mb-5 fade-in">
				<h2 class="text-primary fw-bold">{{ volunteer_event.Title }}</h2>
				<p class="text-muted">Gestion des demandes de participation</p>
			</div>

			<div class="card shadow-sm border-0 fade-in">
				<div class="card-body p-0">
					<div class="table-responsive">
						<table class="table table-hover align-middle mb-0">
							<thead class="bg-light">
								<tr>
									<th class="ps-4 py-3">Bénévole</th>
									<th class="py-3">Date de demande</th>
									<th class="py-3">Statut</th>
									<th class="py-3 text-end pe-4">Actions</th>
								</tr>
							</thead>
							<tbody>
								{% for request in volunteer_event.volunteerEventRequests %}
									<tr>
										<td class="ps-4">
											<div class="d-flex align-items-center">
												<div class="avatar bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 40px; height: 40px;">
													{{ request.volunteer.firstName|first|upper }}{{ request.volunteer.name|first|upper }}
												</div>
												<div>
													<div class="fw-bold text-dark">{{ request.volunteer.firstName }}
														{{ request.volunteer.name|upper }}</div>
													<div class="small text-muted">{{ request.volunteer.email }}</div>
													{% if request.volunteer.phoneNumber %}
														<div class="small text-muted">
															<i class="fas fa-phone me-1"></i>
															{{ request.volunteer.phoneNumber }}</div>
													{% endif %}
												</div>
											</div>
										</td>
										<td>
											{{ request.createdAt|date('d/m/Y H:i') }}
										</td>
										<td>
											{% if request.status == 'PENDING' %}
												<span class="badge bg-warning text-dark">En attente</span>
											{% elseif request.status == 'ACCEPTED' %}
												<span class="badge bg-success">Validée</span>
											{% elseif request.status == 'REFUSED' %}
												<span class="badge bg-danger">Refusée</span>
											{% endif %}
										</td>
										<td class="text-end pe-4">
											{% if request.status == 'PENDING' %}
												<a href="{{ path('app_volunteer_event_handle_request', {'id': request.id, 'status': 'ACCEPTED'}) }}" class="btn btn-success btn-sm me-2" title="Accepter">
													<i class="fas fa-check"></i>
													Accepter
												</a>
												<a href="{{ path('app_volunteer_event_handle_request', {'id': request.id, 'status': 'REFUSED'}) }}" class="btn btn-outline-danger btn-sm" title="Refuser">
													<i class="fas fa-times"></i>
													Refuser
												</a>
											{% else %}
												<span class="text-muted small fst-italic">Traitée</span>
												{# Optionnel : permettre de changer d'avis #}
												<a href="{{ path('app_volunteer_event_handle_request', {'id': request.id, 'status': 'PENDING'}) }}" class="btn btn-link btn-sm text-secondary" title="Réinitialiser">
													<i class="fas fa-undo"></i>
												</a>
											{% endif %}
										</td>
									</tr>
								{% else %}
									<tr>
										<td colspan="4" class="text-center py-5 text-muted">
											<i class="fas fa-inbox fa-3x mb-3 text-light"></i>
											<p class="mb-0">Aucune demande pour ce projet.</p>
										</td>
									</tr>
								{% endfor %}
							</tbody>
						</table>
					</div>
				</div>
			</div>

			<div class="text-center mt-4">
				<a href="{{ path('app_volunteer_event_index') }}" class="btn btn-outline-secondary">
					<i class="fas fa-arrow-left me-2"></i>Retour à la liste des projets
				</a>
			</div>

			<footer class="footer-custom text-center text-muted small py-4 mt-5">
				<div class="footer-line mx-auto"></div>
				<p class="m-0">© 2025 Espace Administrateur Yad Alev</p>
			</footer>

		</div>
	</div>

	<style>
		.navbar {
			border-bottom: 1px solid #e2e8f0;
		}
		.nav-logo {
			width: 48px;
		}
		.nav-icon {
			font-size: 1.4rem;
			color: #444;
			transition: 0.2s;
		}
		.nav-icon:hover {
			color: #0d6efd;
			transform: translateY(-2px);
		}

		.main-container {
			min-height: 100vh;
			display: flex;
			flex-direction: column;
		}
		.fade-in {
			opacity: 0;
			animation: fadeSlide 0.7s ease forwards;
		}
		@keyframes fadeSlide {
			from {
				opacity: 0;
				transform: translateY(25px);
			}
			to {
				opacity: 1;
				transform: none;
			}
		}
		.footer-line {
			width: 85%;
			height: 1px;
			background: #d0d7e0;
		}
	</style>
{% endblock %}
